### ---------------------------------------------------------------------------
### FORMAT MAC ADDRESSES
### ---------------------------------------------------------------------------
- name: "Format MAC addresses"
  set_fact:
     cleaned_macs: "{{ claimed_switch.json.inventory_added | cleanup_switch_mac }}"
     
- name:
  debug:
    var: cleaned_macs
    
### ---------------------------------------------------------------------------
### BUILD PAYLOAD FOR SITE
### ---------------------------------------------------------------------------
- name: "Create a JSON payload with site details"
  template:
    src: mist_assign_switch.j2
    dest: /var/tmp/mist_assign_switch.json
    mode: 0640
    
- name: "Assign Switch to Site"
  uri:
    url: "https://{{ mist_wired.base_url }}/orgs/{{ mist_wired.id_org }}/inventory"
    method: PUT
    status_code: "200"
    headers:
      Content-Type: "application/json"
      Authorization: "Token {{ mist_wired.api_token }}"
    body: "{{ lookup('file','/var/tmp/mist_assign_switch.json') }}"
    force_basic_auth: yes
    body_format: json
  register: assign_switch
